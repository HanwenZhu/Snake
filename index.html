<!DOCTYPE html>
<html>
	<head>
		<title>Snake!!!</title>
		<script type="text/javascript">
var gameWidth = 20;
var gameHeight = 20;
var speed = 100;
var barrier = true;

//Initialize
var url = window.location.href;
var param = url.slice(url.indexOf("?") + 1).split("&");
for(var para = 0; para < param.length; para++) {
	if(param[para].split("=")[0] == "gameWidth") gameWidth = param[para].split("=")[1];
	else if(param[para].split("=")[0] == "gameHeight") gameHeight = param[para].split("=")[1];
	else if(param[para].split("=")[0] == "speed") speed = param[para].split("=")[1];
	else if(param[para].split("=")[0] == "barrier") barrier = param[para].split("=")[1] == "true";
}

//Write
document.write("<div></div>");
document.body.style.margin = "0px";
document.body.style.border = "0px";
var mid = "i" + parseInt(gameHeight / 2) + "j" + parseInt(gameWidth / 2);
if(document.body.clientWidth >= document.body.clientHeight) {
	var blockLength = parseInt((window.screen.availHeight - 108) / gameHeight);
} else {
	var blockLength = parseInt(window.screen.availWidth / gameWidth);
}
document.write("<table style=\"margin:0px auto;border:0px;border-spacing:0px;\">");
for(var i = 0; i < gameHeight; i++) {
	document.write("<tr id=\"i" + i + "\">");
	for(var j = 0; j < gameWidth; j++) {
		document.write("<td width=\"" + blockLength + "px\" height=\"" + blockLength + "px\"id=\"i" + i + "j" + j + "\" style=\"background:#000;padding:0px\"></td>");
	}
	document.write("</tr>");
}
document.write("</table>");
document.write("<p id=\"score\" style=\"margin:0px;border:0px;text-align:center;font-size:32px;\">Score: 0</p>");
document.getElementById(mid).style.background = "#FF0";

//Settings
function settings() {
	
}
document.write("<div id=\"settings\" onclick=\"settings()\" style=\"margin:0px;border:0px;\"><p>test</p></div>");
document.getElementById("settings").style.display = "none";

//Control
var paused = false;
var snakeDirection = "right";
document.onkeydown = function(event){
	var e = event || window.event || arguments.callee.caller.arguments[0];
	if(e && e.keyCode == 37) { //left
		if(prevDirection != "right")
			snakeDirection = "left";
	}
	if(e && e.keyCode == 38) { //up
		if(prevDirection != "down")
			snakeDirection = "up";
	}      
	if(e && e.keyCode == 39) { //right
		if(prevDirection != "left")
			snakeDirection = "right";
	}
	if(e && e.keyCode == 40) { //down
		if(prevDirection != "up")
			snakeDirection = "down";
	}
	if(e && e.keyCode == 32) { //space(pause/continue)
		paused = !paused;
		if(paused) {
			clearTimeout(timeout);
			document.getElementById("settings").style.display = "inline";
		} else {
			document.getElementById("settings").style.display = "none";
			if(!isAlive) {
				clearTimeout(timeout);
				isAlive = true;
				score = 0;
				snake = [mid];
				foodLocation = [];
				currentLocation = [
				parseInt(gameHeight / 2),
				parseInt(gameWidth / 2)
				];
				prevDirection = "";
				for(var i = 0; i < gameHeight; i++)
					for(var j = 0; j < gameWidth; j++)
						document.getElementById("i" + i + "j" + j).style.background = "#000";
				document.getElementById("score").innerHTML = "Score: 0";
				generate();
			}
			snakeMove();
		}
	}
}; 

//Game
var snake = [mid];//first=tail last=head
var foodLocation = [];
var currentLocation = [
parseInt(gameHeight / 2), //row     currentLocation[0]
parseInt(gameWidth / 2)	//column  currentLocation[1]
];
var prevDirection;
var timeout;
var score = 0;
var isAlive = true;
function generate() {
	while(true) {
		foodLocation[0] = parseInt(Math.random() * gameHeight);
		foodLocation[1] = parseInt(Math.random() * gameWidth);
		if(!snake.includes("i" + foodLocation[0] + "j" + foodLocation[1])) break;
	}
	document.getElementById("i" + foodLocation[0] + "j" + foodLocation[1]).style.background = "#F00";
}
function snakeMove() {
	if(isAlive) {
		switch(snakeDirection) {
			case "left":
				currentLocation[1]--;
				break;
			case "up":
				currentLocation[0]--;
				break;
			case "right":
				currentLocation[1]++;
				break;
			case "down":
				currentLocation[0]++;
				break;
		}
		if(currentLocation[0] < 0 || currentLocation[0] >= gameHeight || currentLocation[1] < 0 || currentLocation[1] >= gameWidth) {
			if(barrier) {
				isAlive = false;
				paused = true;
				document.getElementById("settings").style.display = "inline";
			} else {
				if(currentLocation[0] < 0) currentLocation[0] += gameHeight;
				if(currentLocation[0] >= gameHeight) currentLocation[0] -= gameHeight;
				if(currentLocation[1] < 0) currentLocation[1] += gameWidth;
				if(currentLocation[1] >= gameWidth) currentLocation[1] -= gameWidth;
			}
		}
		snake.push("i" + currentLocation[0] + "j" + currentLocation[1]);
		if(isAlive) {
			if(!(currentLocation[0] == foodLocation[0] && currentLocation[1] == foodLocation[1])) {
				document.getElementById(snake[0]).style.background = "#000";
				snake.shift();
			} else {
				generate();
				score++;
				document.getElementById("score").innerHTML = "Score: " + score;
			}
		}
		if(document.getElementById(snake[snake.length - 1]) != null)
			document.getElementById(snake[snake.length - 1]).style.background = "#FF0";
		if(snake.slice(0, snake.length - 1).includes("i" + currentLocation[0] + "j" + currentLocation[1]) && snake) {
			isAlive = false;
			paused = true;
			document.getElementById("settings").style.display = "inline";
		}
		prevDirection = snakeDirection;
	} else {
		for(var index = 0; index < snake.length - 1; index++) {
			if(document.getElementById(snake[index]).style.background == "rgb(255, 255, 0)")
				document.getElementById(snake[index]).style.background = "#000";
			else
				document.getElementById(snake[index]).style.background = "#FF0";
		}
	}
	timeout = setTimeout(function(){snakeMove()}, speed);
}

generate();
snakeMove();
		</script>
	<body style="margin:0px;border:0px;">
		
	</body>
</html>
